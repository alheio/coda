PROJECT (coda)
CMAKE_MINIMUM_REQUIRED (VERSION 2.6)
INCLUDE (CMakeMacro.cmake)

IF(CMAKE_SYSTEM_NAME STREQUAL Linux)
ADD_DEFINITIONS(-DARCH_LINUX)
ELSE(CMAKE_SYSTEM_NAME STREQUAL Linux)
ADD_DEFINITIONS(-DARCH_FREEBSD)
ENDIF(CMAKE_SYSTEM_NAME STREQUAL Linux)

USE_PACKAGE (expat expat.h)

ADD_LIBRARY(MAFSA STATIC MAFSA/automaton_basic.c)
INSTALL(TARGETS MAFSA DESTINATION ${LIBDIR})
INSTALL(DIRECTORY MAFSA/ DESTINATION include/MAFSA FILES_MATCHING PATTERN "*.h")
INSTALL(DIRECTORY MAFSA/ DESTINATION include/MAFSA FILES_MATCHING PATTERN "*.hpp")
INSTALL(DIRECTORY MAFSA/ DESTINATION include/MAFSA FILES_MATCHING PATTERN "*.tcc")

ADD_LIBRARY(uac STATIC uac/sla.c uac/uac.cpp uac/uac-base.c)
ADD_LIBRARY(uacbase STATIC uac/sla.c uac/uac-base.c)

ADD_EXECUTABLE(uac_compiler uac/uac_compiler.cpp)
TARGET_LINK_LIBRARIES(uac_compiler uac coda ${LIB_EXPAT})
ADD_CUSTOM_COMMAND(TARGET uac_compiler POST_BUILD COMMAND ./uac_compiler ${coda_SOURCE_DIR}/uac/uac.xml uac.automaton)

ADD_EXECUTABLE(uac_detect uac/uac_detect.cpp)
TARGET_LINK_LIBRARIES(uac_detect uac coda MAFSA ${LIB_EXPAT})

ADD_EXECUTABLE(test_stringstorage tests/stringstorage/test.c)
TARGET_LINK_LIBRARIES(test_stringstorage coda)

INSTALL(FILES uac/uac.h DESTINATION include/uac)
INSTALL(TARGETS uac DESTINATION ${LIBDIR})
INSTALL(TARGETS uacbase DESTINATION ${LIBDIR})
INSTALL(FILES uac/uac.xml ${coda_BINARY_DIR}/uac.automaton DESTINATION share/uac)
INSTALL(TARGETS uac_detect uac_compiler DESTINATION bin)

AUX_SOURCE_DIRECTORY(coda/ SRC_coda)
ADD_LIBRARY(coda ${SRC_coda})
TARGET_LINK_LIBRARIES(coda ${LIB_expat} pthread)
INSTALL(TARGETS coda DESTINATION ${LIBDIR})
INSTALL(DIRECTORY coda/ DESTINATION include/coda FILES_MATCHING PATTERN "*.h")
INSTALL(DIRECTORY coda/ DESTINATION include/coda FILES_MATCHING PATTERN "*.hpp")
INSTALL(DIRECTORY coda/ DESTINATION include/coda FILES_MATCHING PATTERN "*.tcc")
SET_TARGET_PROPERTIES(coda PROPERTIES VERSION 0.1 SOVERSION 1)

ADD_EXECUTABLE (dic_compiler tests/MAFSA/dic_compiler.cpp tests/MAFSA/dic_adapter.c)
TARGET_LINK_LIBRARIES (dic_compiler MAFSA)
ADD_EXECUTABLE (dic_finder tests/MAFSA/dic_finder.c tests/MAFSA/dic_adapter.c)
TARGET_LINK_LIBRARIES (dic_finder MAFSA)

