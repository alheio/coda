PROJECT(coda)
CMAKE_MINIMUM_REQUIRED(VERSION 2.6)

SET(CMAKE_C_FLAGS "-O3 -Wall -fomit-frame-pointer -funroll-loops -Wno-long-long -Wno-variadic-macros -fPIC")
SET(CMAKE_CXX_FLAGS "${CMAKE_C_FLAGS}")

IF(CMAKE_SYSTEM_NAME STREQUAL Linux)
ADD_DEFINITIONS(-DARCH_LINUX)
ELSE(CMAKE_SYSTEM_NAME STREQUAL Linux)
ADD_DEFINITIONS(-DARCH_FREEBSD)
ENDIF(CMAKE_SYSTEM_NAME STREQUAL Linux)

FIND_PATH(INCLUDE_EXPAT expat.h)
INCLUDE_DIRECTORIES(${INCLUDE_EXPAT})
FIND_LIBRARY(LIB_EXPAT expat)

INCLUDE_DIRECTORIES(.)

SET (LIBDIR lib)
IF (${CMAKE_SYSTEM_PROCESSOR} STREQUAL "x86_64")
SET (LIBDIR lib64)
ENDIF (${CMAKE_SYSTEM_PROCESSOR} STREQUAL "x86_64")

AUX_SOURCE_DIRECTORY(coda/ SRC_coda)
ADD_LIBRARY(coda ${SRC_coda})
TARGET_LINK_LIBRARIES(coda ${LIB_expat} pthread dl)
INSTALL(TARGETS coda DESTINATION ${LIBDIR})
INSTALL(DIRECTORY coda/ DESTINATION include/coda FILES_MATCHING PATTERN "*.h")
INSTALL(DIRECTORY coda/ DESTINATION include/coda FILES_MATCHING PATTERN "*.hpp")
INSTALL(DIRECTORY coda/ DESTINATION include/coda FILES_MATCHING PATTERN "*.tcc")
SET_TARGET_PROPERTIES(coda PROPERTIES VERSION 0.1 SOVERSION 1)

